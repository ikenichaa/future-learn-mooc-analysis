---
title: "Future Learn - Analysis Report"
author: "Nicha Wilanan"
date: "2024-10-31"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir= normalizePath('..'))
```


```{r, include=FALSE, message=FALSE}
library(ProjectTemplate)
load.project()
```

# Introduction
TODO:

# CRISP-DM Round 1

## 1. Business Understandings

## 1.1 Determine Business Objective
This report aims to gather information for a book author on learning strategies to gain more insights into the characteristics of each type of learner. The stakeholder's objective is to see how each archetype is different in their study's outcome or study method. The stakeholder aims to use this research as a stepping-stone to know the differences or similarities between the archetypes. Therefore, the criteria for the success finding in this report is to figure out whether the archetypes contribute to the uniqueness of study results or study methods. It could end up that each type is unique or it can be that all types share similar methods and outcomes.

## 1.2 Assess Situation 
The risk for the report is that it relies mainly on the learner’s survey response on their archetype, so the answer may not be accurate in case the learners do not answer truthfully. Moreover, the analysis may not reflect all learners’ method of study as there are only a minority of learners complete the survey. 

There is one terminology in this phase, which is the word *learner archetype*. The learner archetype groups learners with the same behaviour together. In this report, there are 7 archetypes - advancers, explorers, fixers, flourishers, hobbyists, preparers and vitalisers. To learn more about the archetype, go through this  [link.](https://ugc.futurelearn.com/uploads/files/2f/ce/2fce94dd-54e6-4614-972d-ce9c3a6d7d91/Learner-Archetypes.pdf)

## 1.3 Produce Project Plan 
The analysis will follow the CRISP-DM methodologies for two cycles in order to know more about the archetype study result and study strategy. Each cycle will come up with a main research topic. After exploring and analyse data, the findings will be evaluated. In this research, R language is used to extract the insights through statistical summary and visualization.  

Initially, the research question will aim to see the result of the course completion on each archetype. The main research topic for this cycle is: 

**Does the learner archetype affect online course completion rate?** 

Noted that the *completion* in this report refers to the learners who accomplished more than 80% of the course content.

## 1.4 Determine Data Mining Goals
To know that the learners' archetype affect online course completion rate, a solid pattern of completion for the archetype on every run must be found. If the completion rate in each archetypes are random, it cannot be deduce that the archetype actually affect the course completion.

## 2. Data Understanding
## 2.1 Collect Initial Data
Future-Learn collected and provided the data that will be used in this report. For this CRISP-DM cycle, three groups of datasets will be utilized. First is the data of archetype survey responses, which will be used to gather the learner's archetype. Second is the course enrollment data that tells how many people enrolled in each course. Lastly, the course activity determines how far the learner goes through the steps in the course.

## 2.2 Describe Data

The data is gathered from a course named **Cyber Security: Safety at Home, Online, in Life.** This course is designed to be finished in three weeks. Each week consists of multiple steps, including articles, videos, quizzes, and discussions. From September 2016 to September 2018, the course had been run for 7 times. Throughout the years, steps are added to enhance learner understandings. From `r count(distinct(activity_1, week_number, step_number))` steps in the first run, the run was gradually enhanced to `r count(distinct(activity_7, week_number, step_number))` steps in the seventh run. The datasets of archetype, course enrollment, and course activity are kept for each run.

These are the list of tables for this analysis and its field name:

1. Enrollment: `r colnames(cyber.security.1_enrolments)`
2. Activity Step: `r colnames(cyber.security.1_step.activity)`
3. Archetype Survey Response: `r colnames(cyber.security.3_archetype.survey.responses)`

The field that are picked for the analysis will be mentioned in part 3.1.


## 2.3 Explore Data

```{r, echo=FALSE}
# Get the enrollment number for each run
enroll_num <- c(
    nrow(unique(enroll_1[, 'learner_id'])),
    nrow(unique(enroll_2[, 'learner_id'])),
    nrow(unique(enroll_3[, 'learner_id'])),
    nrow(unique(enroll_4[, 'learner_id'])),
    nrow(unique(enroll_5[, 'learner_id'])),
    nrow(unique(enroll_6[, 'learner_id'])),
    nrow(unique(enroll_7[, 'learner_id']))
)

# Add comma to the enrollment number 
enroll_num_prettify <- formatC(enroll_num,format="d", big.mark=",")

# Get the number of learner who complete the course in each run
finish_num <- c(
    nrow(activity_1_learner_progress_archetype |> filter(finish_percentage > 80)),
    nrow(activity_2_learner_progress_archetype |> filter(finish_percentage > 80)),
    nrow(activity_3_learner_progress_archetype |> filter(finish_percentage > 80)),
    nrow(activity_4_learner_progress_archetype |> filter(finish_percentage > 80)),
    nrow(activity_5_learner_progress_archetype |> filter(finish_percentage > 80)),
    nrow(activity_6_learner_progress_archetype |> filter(finish_percentage > 80)),
    nrow(activity_7_learner_progress_archetype |> filter(finish_percentage > 80))
)

# Add comma to the course completion number
finish_num_prettify <- formatC(finish_num,format="d", big.mark=",")

# Calculate the percentage of course completion
percent_finish <- paste(round(finish_num/enroll_num * 100, 2), "%")

# Construct the enrollment and completion data frame
enroll_and_finish_df <- data.frame(Enrollment=enroll_num_prettify, Finisher=finish_num_prettify, Finisher_Percentage = percent_finish)

# Add row name
rownames(enroll_and_finish_df) <- c('Run 1', 'Run 2', 'Run 3', 'Run 4', 'Run 5', 'Run 6', 'Run 7')

# Show the result as a table
kable(enroll_and_finish_df, caption = "Enrollment and course finisher percentage")
```

The table above shows a vast difference in the enrollment number and the finisher in each run. In this report, the learners are considered to finish the course if they finish more than or equal to 80% of the activities. There is a clear pattern that most people do not finish the course, with the lowest number of finishers compared to the enroller in Run 6 at approximately 10% and the highest number in Run 5 at almost 20%. 

```{r, echo=FALSE, out.width="70%", fig.align='center', fig.cap="Number of learners by archetype in each run"}
# Construct the theme for subplot
common_theme <- theme_minimal() +
    theme(
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        legend.position="none", # Remove individual legends
    )

# Construct the color value representing each archetype for subplot
common_scale <- scale_fill_manual(
    name = "Archetype",
    values = c(
        "Advancers" = "#F08080",
        "Explorers" = "#DAA520",
        "Fixers" = "#90EE90",
        "Flourishers" = "#98FB98",
        "Hobbyists" = "#40E0D0",
        "Other" = "#87CEEB",
        "Preparers" = "#DDA0DD",
        "Vitalisers" = "#FF69B4"
    )
)

# Plot a graph of counting number of learners in each archetype for run 3
a_3 <- archetype_counts |> filter(run=="3") |> 
    ggplot(aes(x = archetype, y = count, fill = archetype)) + 
    geom_bar(stat='identity') +
    common_theme +
    common_scale +
    labs(
        x = "Archetype",
        y = "Count",
        title = "Run 3"
    )

# Plot a graph of counting number of learners in each archetype for run 4
a_4 <- archetype_counts |> filter(run=="4") |> 
    ggplot(aes(x = archetype, y = count, fill = archetype)) + 
    geom_bar(stat='identity') +
    common_theme +
    common_scale +
    labs(
        x = "Archetype",
        y = "Count",
        title = "Run 4"
    )

# Plot a graph of counting number of learners in each archetype for run 5
a_5 <- archetype_counts |> filter(run=="5") |> 
    ggplot(aes(x = archetype, y = count, fill = archetype)) + 
    geom_bar(stat='identity') +
    common_theme +
    common_scale +
    labs(
        x = "Archetype",
        y = "Count",
        title = "Run 5"
    )

# Plot a graph of counting number of learners in each archetype for run 6
a_6 <- archetype_counts |> filter(run=="6") |> 
    ggplot(aes(x = archetype, y = count, fill = archetype)) + 
    geom_bar(stat='identity') +
    common_theme +
    common_scale +
    labs(
        x = "Archetype",
        y = "Count",
        title = "Run 6"
    )

# Plot a graph of counting number of learners in each archetype for run 7
a_7 <- archetype_counts |> 
    filter(run=="7") |> 
    ggplot(aes(x = archetype, y = count, fill = archetype)) +
    common_theme +
    geom_bar(stat='identity') +
    common_scale +
    labs(
        x = "Archetype",
        y = "Count",
        title = "Run 7"
    )

# Aggregate the archetype count subplot together
archetype_plot <- ggarrange(a_3, a_4, a_5, a_6, a_7,  common.legend = TRUE, legend = "bottom")

# Annotate the plot to show and add title to the plot
annotate_figure(
  archetype_plot, 
  top = text_grob(
          "Number of learners by archetype in each run", 
          face = "bold", 
          size = 12, 
          hjust = 0, 
          vjust = 0.4, 
          x = 0
  )
)
```


When comparing the number of archetype in each run, it is obvious that the number of each archetype does not distribute evenly among the learners. The top 4 archetypes posess by the learner are *Vitalisers*, *Advancers*, *Explorers* and *Fixers*.


## 2.4 Verify Data Quality

The data quality of this round analysis is quite good and there are no missing data in the available table. Although archetype survey response of Run 1 and Run 2 were not kept, the report can still analyse the link between archetype and learner finishing rate from other runs. The only concern is that the survey response rate is low comparing to the enrollment, which will be hard to deduce the result of archetype effect from a whole enrollment population.

```{r, echo=FALSE}
# Count the number of archetype survey response for each run
archetype_response_num <- c(
    nrow(arch_1),
    nrow(arch_2),
    nrow(arch_3),
    nrow(arch_4),
    nrow(arch_5),
    nrow(arch_6),
    nrow(arch_7)
)

# Calculate the percentage of survey response compare to all enrolment number
percent_response <- paste(round(archetype_response_num/enroll_num * 100, 2), "%")

# Construct the enrollment and survey response data frame
enroll_and_response_df <- data.frame(Enrollment=enroll_num_prettify, Response_Survey=archetype_response_num, Response_Percentage = percent_response)

# Add row names
rownames(enroll_and_response_df) <- c('Run 1', 'Run 2', 'Run 3', 'Run 4', 'Run 5', 'Run 6', 'Run 7')

# Show the result table
kable(enroll_and_response_df, caption="Archetype response survey percentage")
```

## 3. Data Preparation
## 3.1 Select Data

1. Enrolment:
The enrolment data is used just for the exploratory purpose and to understand learners more. There is no direct use to answer the main questions on the archetype.

2. Activity Step:
This data is going to be used as a criteria on finding successful learner. To check that learners completed more than 80% of the steps in the module, the learner_id, week_number, step_number, and last_completed_at will be used.

3. Archetype:
This table is another main table that will be used along with the activity step. It is needed to know the learner archetype. There are two column being used, learner_id and archetype.


## 3.2 Clean Data
The data selected is quite clean, so we are going to clean it just by select the fields needed and keep only the unique rows.

## 3.3 Construct Data
After selected the field, new table is created from attributes in the activity step data set. This new table calls *learner_progress*, which contains learner progress and the archetype. Each run has its own *learner_progress* table. To construct the new table, firstly, count the number of steps each learner finished. Then, compare number of finished steps to number of all steps and put it in *finish_percentage* field. Later, add *finish* field that stores boolean value of whether the steps are complete more than 80%.

## 3.4 Integrate Data
Afterwards, the *learner_progress* table is merged with the archetype table by *learner_id* to show the type of each learner if any. This new table is called *learner_progress_archetype.* Again, each run has its own *learner_progress_archetype* table.

## 4. Modelling
```{r, echo=FALSE}
# Construct the summary table for run 3 on the number of learners who complete and not complete the course by archetype
a_3_summary <- activity_3_learner_progress_archetype |> 
    group_by(archetype, finish) |> 
    summarize(count = n(), .groups = 'drop') |>
    pivot_wider(names_from = archetype, values_from = count) |>
    mutate(Run = "3") |>
    mutate(Preparers = 0) |>
    relocate(Run, .after = finish) |>
    relocate(Preparers, .after = Other)

# Construct the summary table for run 4 on the number of learners who complete and not complete the course by archetype
a_4_summary <- activity_4_learner_progress_archetype |> 
    group_by(archetype, finish) |> 
    summarize(count = n(), .groups = 'drop') |>
    pivot_wider(names_from = archetype, values_from = count) |>
    mutate(Run = "4") |>
    relocate(Run, .after = finish)

# Construct the summary table for run 5 on the number of learners who complete and not complete the course by archetype
a_5_summary <- activity_5_learner_progress_archetype |> 
    group_by(archetype, finish) |> 
    summarize(count = n(), .groups = 'drop') |>
    pivot_wider(names_from = archetype, values_from = count) |>
    mutate(Run = "5") |>
    relocate(Run, .after = finish)

# Construct the summary table for run 6 on the number of learners who complete and not complete the course by archetype
a_6_summary <- activity_6_learner_progress_archetype |> 
    group_by(archetype, finish) |> 
    summarize(count = n(), .groups = 'drop') |>
    pivot_wider(names_from = archetype, values_from = count) |>
    mutate(Run = "6") |>
    relocate(Run, .after = finish)

# Construct the summary table for run 7 on the number of learners who complete and not complete the course by archetype
a_7_summary <- activity_7_learner_progress_archetype |> 
    group_by(archetype, finish) |> 
    summarize(count = n(), .groups = 'drop') |>
    pivot_wider(names_from = archetype, values_from = count) |>
    mutate(Run = "7") |>
    relocate(Run, .after = finish)

# Construct the summary table for all runs on the number of learners who COMPLETE the course by archetype
complete_learner_archetype <- rbind(
    a_3_summary,
    a_4_summary,
    a_5_summary,
    a_6_summary,
    a_7_summary
) |> filter(finish == TRUE) |> select(-finish)

# Use zero for the archetype with no data
complete_learner_archetype[is.na(complete_learner_archetype)] <- 0

# Construct the summary table for all runs on the number of learners who NOT COMPLETE the course by archetype
incomplete_learner_archetype <- rbind(
    a_3_summary,
    a_4_summary,
    a_5_summary,
    a_6_summary,
    a_7_summary
) |> filter(finish == FALSE) |> select(-finish)

# Use zero for the archetype with no data 
incomplete_learner_archetype[is.na(incomplete_learner_archetype)] <- 0
```


As right now we have all data prepared, we will examine our main research topic for this round, **Does the learner archetype affect online course completion rate?**

## 4.1 Archetype of learners who completed the course
Let start by take a look at the table below on the archetype of the learner who complete the course.

```{r, echo=FALSE}
kable(complete_learner_archetype, caption = "Archetype of the learners who complete the course")
```

As mentioned before, not many people response to the survey of the archetype, so the majority of learner archetype is unknown. If we ignore unknown type, depends on each run, some archetype perform better than the others. To compare fairly, the data is scaled for each run, so that the number of completers can be compare properly throughout different run. Or else the priority would be given to the run with higher enrollment as higher enrolment has higher chance to have a higher finishers. The brighter color on the heatmap represents more number of successful learners in that archetype.


```{r, echo=FALSE, out.width="70%", fig.align='center', fig.cap="Heatmap showing scaled number of learners who complete the course in each run"}
# Filter archetype and scale the data by row
scale_complete <- complete_learner_archetype[, -c(1, ncol(complete_learner_archetype))] |>
    apply(1, scale) |> as.data.frame()

# Add column name
colnames(scale_complete) <- c('Run 3', 'Run 4', 'Run 5', 'Run 6', 'Run 7')

# Add row name
rownames(scale_complete) <- c('Advancers', 'Explorers', 'Fixers', 'Flourishers', 'Hobbyists', 'Other', 'Preparers', 'Vitalisers')

# Update the row name to column archetype
scale_complete <- tibble::rownames_to_column(scale_complete, "archetype")

# Prepare heatmap data by pivot longer
heatmap_data <- scale_complete |>
    pivot_longer(cols = starts_with("Run"),
                names_to = "Run",
                values_to = "Scale")

# Plot the heatmap comparing the scale of learner who completed the course
scale_completion_plot <- ggplot(heatmap_data, aes(x = Run, y = archetype, fill = Scale)) +
    geom_tile() +
    scale_fill_viridis_c(option = "A") +
    theme_minimal() +
    labs(x = "run")

# Annotate figure
annotate_figure(
  scale_completion_plot, 
  top = text_grob(
          "Heatmap showing scaled number of learners who complete the course in each run", 
          face = "bold", 
          size = 12, 
          hjust = 0, 
          vjust = 0.4, 
          x = 0
  )
)
```


From the heatmap, it is evident that *vitalisers* archetype perform best in all run comparing to other archetype followed by *advancers* and *explorers*, where they have less completer than the others in some runs. However, it needs to be tackle that did vitalisers perform better just because most people are *vitalisers* or it is really affect the course completion. To check the performance, the success rate vs unsuccess rate for each archetype will be compared.

## 4.2 Success rate for each learners' archetype
For this part, let we determine the ratio of learner with same archetype that complete or not complete the course. If the success rate within the archetype is high, it can be deduced that the archetype affect the online course completion.

```{r, echo=FALSE}
# Calculate the percentage of completion rate for each archetype
success_rate_for_learner_archetype <- 
    round((complete_learner_archetype[,c(-1, -ncol(complete_learner_archetype))]/
         (incomplete_learner_archetype[,c(-1, -ncol(complete_learner_archetype))]+
              complete_learner_archetype[,c(-1, -ncol(complete_learner_archetype))])) * 100, 2)

# Use zero for data that has no value
success_rate_for_learner_archetype[is.na(success_rate_for_learner_archetype)] <- 0 

# Add percentage symbol
success_rate_for_learner_archetype[] <- lapply(success_rate_for_learner_archetype, function(x) paste(format(x, nsmall=2), "%"))

# Add field run
success_rate_for_learner_archetype$Run <- c('3', '4', '5', '6', '7')

# Relocate field run to be the first column
success_rate_for_learner_archetype <- success_rate_for_learner_archetype |> relocate(Run, .before = Advancers)

```

```{r, echo=FALSE}
# Show table
kable(success_rate_for_learner_archetype, caption = "Course completion rate by archetype")
```

By checking the percentage of completion on each archetype, the result is low and random among different learner's type in each run. The low success rate among each archetype is not surprising because the overall finish rate as a whole shows in *Table 1* is also low.


## 5 Evaluation
## 5.1 Evaluate Results
After explore the data on archetype and course completion rate thoroughly, the archetype has no distinctive effect on the completion. At first glance, some archetype is standing out to have more number of complete learner but actually that is happening because there are more learner in that archetype as a whole so there is a higher chance for learners in that archetype to finish the course more. When comparing the success rate for each archetype, the result is too random in all archetype to have a significant impact on the course completion. Although the rate of completion of the learner with known archetype is more than the overall completion rate, there is a lack of solid pattern among the archetype in each run. Based on the findings, the archetype does not affect whether or not learner finish the online course.

## 5.2 Review Process
Data wrangling and data exploration have been revisited. The results provided above are legit.

## 5.3 Determine next steps
It is known that the type of learner solely cannot use to determined the completion rate, so it can be concluded that the archetype cannot determine the study outcome. For the next phase, the research will go deeper into 

# CRISP-DM Round 2
## Business Understanding
In this round, instead of using the survey response from users, we are going to investigate the user success rate through users' actions in the course.

## 1.1 Determine Business Objective
The business objective for this round is exactly the same as the first round. The stakeholder wants to know the common traits of the course completer.

## 1.2 Assess Situation
There is lower risks in this phase as we do not rely on the user survey response. There is a dataset that shows the first visited date and last completed date of each learners for each step in the course. This report will assume that the data were collected accurately and can be used straightaway.

## 1.3 Produce Project Plan
As we now realize that the archetype doesn't affect the result, we need to take a look at the action made by the learners. As the course is designed to finished the sub-steps within a week, we will examined that is there a higher chance for a learner to finish a course if they can follow the course schedule.

Therefore, the main research topic for the second cycle is:
**Does following course schedule contribute to course completion?**

## 1.4 Determine Data Mining Goals
If keeping to the course schedule can make a learner complete the course.


